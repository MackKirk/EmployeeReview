{% extends 'base.html' %}
{% block title %}Administration{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto bg-white p-8 rounded-xl shadow space-y-6">
  <h1 class="text-3xl font-bold text-gray-800">Administration</h1>

  <div class="flex items-center justify-between">
    <p class="text-gray-600">Send review emails by role:</p>
    <div class="space-x-2">
      <form method="post" action="/admin/send-review-links" class="inline">
        <input type="hidden" name="role" value="employee">
        <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Send to Employees</button>
      </form>
      <form method="post" action="/admin/send-review-links" class="inline">
        <input type="hidden" name="role" value="supervisor">
        <button class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">Send to Supervisors</button>
      </form>
      <form method="post" action="/admin/send-review-links" class="inline">
        <input type="hidden" name="role" value="administration">
        <button class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">Send to Administration</button>
      </form>
    </div>
  </div>

  {% if message %}
    <div class="p-3 rounded bg-green-50 text-green-800 border border-green-200">{{ message }}</div>
  {% endif %}
  {% if error %}
    <div class="p-3 rounded bg-red-50 text-red-800 border border-red-200">{{ error }}</div>
  {% endif %}

  <div class="overflow-x-auto">
    <table class="w-full table-auto border border-gray-300 rounded-md overflow-hidden">
      <thead class="bg-gray-100 text-gray-700">
        <tr>
          <th class="p-3 text-left">Name</th>
          <th class="p-3 text-left">Role</th>
          <th class="p-3 text-left">Supervisor</th>
          <th class="p-3 text-center">Self</th>
          <th class="p-3 text-center">Supervisor</th>
          <th class="p-3 text-center">Director</th>
          <th class="p-3 text-center">Email</th>
          <th class="p-3 text-center">Clicked</th>
          <th class="p-3 text-center">Action</th>
        </tr>
      </thead>
      <tbody class="text-sm text-gray-700 divide-y divide-gray-200">
        {% for row in rows %}
        <tr class="hover:bg-gray-50">
          <td class="p-3 font-medium">{{ row.employee.name }}</td>
          <td class="p-3">
            <form method="post" action="/admin/update-employee/{{ row.employee.id }}" class="flex items-center space-x-2">
              <select name="role" class="border rounded px-2 py-1">
                {% for r in allowed_roles %}
                  <option value="{{ r }}" {% if row.employee.role == r %}selected{% endif %}>{{ r }}</option>
                {% endfor %}
              </select>
          </td>
          <td class="p-3">
              <select name="supervisor_name" class="border rounded px-2 py-1 w-56">
                <option value="">None</option>
                {% for n in names %}
                  <option value="{{ n }}" {% if row.employee.supervisor_email == n %}selected{% endif %}>{{ n }}</option>
                {% endfor %}
              </select>
          </td>
          <td class="p-3 text-center">{% if row.employee_done %}‚úÖ{% else %}‚ùå{% endif %}</td>
          <td class="p-3 text-center">{% if row.supervisor_done %}‚úÖ{% else %}‚ùå{% endif %}</td>
          <td class="p-3 text-center">{% if row.director_done %}‚úÖ{% else %}‚ùå{% endif %}</td>
          <td class="p-3 text-center">{% if row.has_sent %}üìß{% else %}‚Äî{% endif %}</td>
          <td class="p-3 text-center">{% if row.has_clicked %}üü¢{% else %}‚Äî{% endif %}</td>
          <td class="p-3 text-center">
              <button class="mr-3 bg-gray-100 px-3 py-1 rounded hover:bg-gray-200">Save</button>
            </form>
            <form method="post" action="/admin/send-review-link/{{ row.employee.id }}" class="inline">
              <button class="text-blue-600 font-semibold hover:underline">Send email</button>
            </form>
            <a href="/director/review/{{ row.employee.id }}" class="ml-3 text-gray-700 hover:underline">View compare</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    
  </div>
</div>
{% endblock %}


