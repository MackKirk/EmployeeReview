{% extends 'base.html' %}
{% block title %}Employee profile — {{ employee.name }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto bg-white p-6 rounded-xl shadow space-y-6">
  <div class="flex items-center justify-between">
    <h1 class="text-2xl font-bold text-gray-800">Employee profile</h1>
    <a href="/admin" class="text-blue-600 hover:underline">← Back to Admin</a>
  </div>

  {% if message %}
  <div class="p-3 rounded bg-green-50 text-green-800 border border-green-200">{{ message }}</div>
  {% endif %}
  {% if error %}
  <div class="p-3 rounded bg-red-50 text-red-800 border border-red-200">{{ error }}</div>
  {% endif %}

  <form method="post" action="/admin/update-employee/{{ employee.id }}" class="space-y-6">
    <input type="hidden" name="redirect_to" value="/admin/employee/{{ employee.id }}">

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
        <div class="p-2 bg-gray-50 rounded border border-gray-200 text-gray-700">{{ employee.name }}</div>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
        <div class="p-2 bg-gray-50 rounded border border-gray-200 text-gray-700">{{ employee.email }}</div>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Birth date</label>
        <div class="p-2 bg-gray-50 rounded border border-gray-200 text-gray-700">{{ employee.birth_date.strftime('%Y-%m-%d') if employee.birth_date else '—' }}</div>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Role</label>
        <select name="role" class="w-full border border-gray-300 rounded px-3 py-2">
          {% for r in allowed_roles %}
          <option value="{{ r }}" {% if employee.role == r %}selected{% endif %}>{{ r }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Supervisor</label>
        <select name="supervisor_name" class="w-full border border-gray-300 rounded px-3 py-2">
          <option value="">None</option>
          {% for n in names %}
          <option value="{{ n }}" {% if employee.supervisor_email == n %}selected{% endif %}>{{ n }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Self schedule (meeting)</label>
        <input type="datetime-local" name="self_scheduled_at" value="{{ self_scheduled_at_value or '' }}" class="w-full border border-gray-300 rounded px-3 py-2">
      </div>
    </div>

    <hr class="border-gray-200">
    <h2 class="text-lg font-semibold text-gray-800">Extended profile</h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Department</label>
        <input type="text" name="department" value="{{ employee.department or '' }}" class="w-full border border-gray-300 rounded px-3 py-2" placeholder="Department">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Position</label>
        <input type="text" name="position" value="{{ employee.position or '' }}" class="w-full border border-gray-300 rounded px-3 py-2" placeholder="Position">
      </div>
      <div class="md:col-span-2">
        <label class="block text-sm font-medium text-gray-700 mb-1">Years/Months with MK</label>
        <input type="text" name="years_months_with_mk" value="{{ employee.years_months_with_mk or '' }}" class="w-full border border-gray-300 rounded px-3 py-2" placeholder="e.g. 2 years 3 months">
      </div>
      <div class="md:col-span-2">
        <label class="block text-sm font-medium text-gray-700 mb-1">Pay/hr (Last 3 years)</label>
        <textarea name="pay_hr_last_3_years" rows="2" class="w-full border border-gray-300 rounded px-3 py-2" placeholder="Pay per hour (last 3 years)">{{ employee.pay_hr_last_3_years or '' }}</textarea>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Loan Amount</label>
        <input type="text" name="loan_amount" value="{{ employee.loan_amount or '' }}" class="w-full border border-gray-300 rounded px-3 py-2" placeholder="Loan amount">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">LMIA</label>
        <select name="lmia" class="w-full border border-gray-300 rounded px-3 py-2">
          <option value="">—</option>
          <option value="SKILLED" {% if (employee.lmia or '').upper() == 'SKILLED' %}selected{% endif %}>SKILLED</option>
          <option value="UNSKILLED" {% if (employee.lmia or '').upper() == 'UNSKILLED' %}selected{% endif %}>UNSKILLED</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Company Phone</label>
        <input type="text" name="company_phone" value="{{ employee.company_phone or '' }}" class="w-full border border-gray-300 rounded px-3 py-2" placeholder="Allowance or iPhone">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Company Laptop/iPad</label>
        <input type="text" name="company_laptop_ipad" value="{{ employee.company_laptop_ipad or '' }}" class="w-full border border-gray-300 rounded px-3 py-2" placeholder="e.g. Laptop, iPad">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Drive Company Vehicle</label>
        <select name="drive_company_vehicle" class="w-full border border-gray-300 rounded px-3 py-2">
          <option value="">—</option>
          <option value="Y" {% if (employee.drive_company_vehicle or '').upper() == 'Y' %}selected{% endif %}>Y</option>
          <option value="N" {% if (employee.drive_company_vehicle or '').upper() == 'N' %}selected{% endif %}>N</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Company Gas Card</label>
        <select name="company_gas_card" class="w-full border border-gray-300 rounded px-3 py-2">
          <option value="">—</option>
          <option value="Y" {% if (employee.company_gas_card or '').upper() == 'Y' %}selected{% endif %}>Y</option>
          <option value="N" {% if (employee.company_gas_card or '').upper() == 'N' %}selected{% endif %}>N</option>
        </select>
      </div>
      <div class="md:col-span-2">
        <label class="block text-sm font-medium text-gray-700 mb-1">Skills Trade Completed</label>
        <input type="text" name="skills_trade_completed" value="{{ employee.skills_trade_completed or '' }}" class="w-full border border-gray-300 rounded px-3 py-2" placeholder="e.g. lvl 1, 2, 3 Red Seal">
      </div>
      <div class="md:col-span-2">
        <label class="block text-sm font-medium text-gray-700 mb-1">Safety Infraction Description</label>
        <textarea name="safety_infraction_description" rows="3" class="w-full border border-gray-300 rounded px-3 py-2" placeholder="Safety infraction description">{{ employee.safety_infraction_description or '' }}</textarea>
      </div>
    </div>

    <div class="flex gap-3 pt-4">
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Save</button>
      <a href="/admin" class="bg-gray-100 text-gray-800 px-4 py-2 rounded hover:bg-gray-200">Cancel</a>
    </div>
  </form>
</div>
{% endblock %}
